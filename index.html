<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Smart Portfolio Allocator</title>
  <style>
    :root {
      --dark-bg: #000000;
      --dark-text: #ffffff;
      --dark-input-bg: #0000FF;  /* pure blue in dark mode */
      --dark-input-text: #ffffff;
      --light-bg: #f9f9f9;
      --light-text: #333;
      --light-input-bg: #ffffff;
      --light-input-text: #333;

      --remove-btn: #FF0000;     /* pure red for Remove & Get Live Rates */
      --add-btn:    #00FF00;     /* pure green */
      --calc-btn:   #00FFFF;     /* cyan for Calculate Allocations */

      --input-scale: 0.85;       /* about 15% smaller than normal */
      --label-font:  0.85em;     /* smaller label text */
      --field-font:  0.8em;      /* smaller text inside inputs/selects */
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      font-size: 110%;
      transition: background-color 0.3s, color 0.3s;
    }

    /* THEME MODES */
    body.light-mode {
      background-color: var(--light-bg);
      color: var(--light-text);
    }
    body.light-mode input, body.light-mode select {
      background-color: var(--light-input-bg);
      color: var(--light-input-text);
    }
    body.dark-mode {
      background-color: var(--dark-bg);
      color: var(--dark-text);
    }
    body.dark-mode input, body.dark-mode select {
      background-color: var(--dark-input-bg);
      color: var(--dark-input-text);
      border: 1px solid #666;
    }
    @media (prefers-color-scheme: dark) {
      body.system-mode {
        background-color: var(--dark-bg);
        color: var(--dark-text);
      }
      body.system-mode input, body.system-mode select {
        background-color: var(--dark-input-bg);
        color: var(--dark-input-text);
      }
    }
    @media (prefers-color-scheme: light) {
      body.system-mode {
        background-color: var(--light-bg);
        color: var(--light-text);
      }
      body.system-mode input, body.system-mode select {
        background-color: var(--light-input-bg);
        color: var(--light-input-text);
      }
    }

    /* MAIN HEADING */
    .main-heading {
      text-align: center;   /* place heading exactly centered */
      margin: 20px 0;       /* some spacing above/below */
    }

    /* ICON ROW */
    .icon-row {
      display: flex;
      justify-content: center;  /* center icons themselves */
      align-items: center;
      gap: 20px;
      margin-bottom: 20px;      /* space below icons */
    }
    .icon-row button {
      background: none;
      border: none;
      font-size: 1.2em;
      cursor: pointer;
    }
    .theme-status {
      position: absolute;
      top: -15px; right: 0;
      font-size: 0.8em;
      opacity: 0;
      transition: opacity 0.3s;
    }

    /* CONTAINER FOR REST */
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
      text-align: center;  /* center the content */
    }

    /* FLEX LAYOUT FOR TOP INPUTS */
    .flex-row {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 10px;
      width: 100%;
    }
    .flex-col {
      display: flex;
      flex-direction: column;
      margin-right: 30px;
      margin-bottom: 10px;
      align-items: flex-start;
    }

    label {
      margin-bottom: 4px;
      font-size: var(--label-font);
    }

    input, select {
      transform: scale(var(--input-scale));
      transform-origin: top left;
      padding: 4px 6px;
      font-size: var(--field-font);
      border-radius: 0;
      border: 1px solid #ccc;
      outline: none;
    }
    select::-ms-expand {
      display: none;
    }
    button {
      padding: 4px 10px;
      font-size: 0.9em;
      border-radius: 0;
      border: none;
      margin: 5px;
      cursor: pointer;
    }

    .btn-remove {
      background-color: var(--remove-btn);
      color: #fff;
      white-space: nowrap;
      height: 28px;
      display: flex;
      align-items: flex-end;  /* lower the text vs. stable input */
      justify-content: center;
      padding-bottom: 4px;    /* push text a bit lower */
    }
    .btn-add {
      background-color: var(--add-btn);
      color: #000;
    }
    .btn-get-rates {
      background-color: var(--remove-btn);
      color: #fff;
    }
    .btn-calculate {
      background-color: var(--calc-btn);
      color: #000;
    }

    /* POSITIONS LAYOUT */
    .positions-container {
      margin-bottom: 20px;
      display: inline-block;
      text-align: left;
    }
    .positions-header-row {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin: 10px 0;
    }
    .position-row {
      display: flex;
      flex-wrap: nowrap;
      align-items: center;
      margin-bottom: 10px;
    }
    .position-field {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-right: 15px;
    }
    .ticker-input {
      width: 70px;
    }
    .percent-select {
      width: 80px;
    }
    .base-input, .stable-input {
      width: 80px;
      height: 24px;
    }

    .bottom-btn-row {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
    }

    /* RESULTS TABLE */
    table {
      margin: 20px auto;
      border-collapse: collapse;
      width: 90%;
      max-width: 1000px;
      font-size: 0.9em;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
  </style>
</head>
<body class="light-mode">
  <!-- Minimal inline jsPDF for PDF creation -->
  <script>
    window.jsPDF=(function(){function e(e,t){return e.appendChild(t),t}var t=function(n,o){function r(e){return n.document.createTextNode(e)}var i=n.createElement("div");o&&(i.id=o);return{el:i,addText:function(t){e(i,r(t))},setClass:function(e){i.className=e}}};return{createBlock:t}}(document);
    function createPDF(content){
      const w=window.open("","_blank");
      if(!w){alert("Popups blocked!");return;}
      w.document.open();
      w.document.write("<html><body><pre>"+content+"</pre></body></html>");
      w.document.close();
      w.focus();
      w.print();
      w.close();
    }
  </script>

  <!-- MAIN HEADING EXACTLY CENTERED -->
  <h1 class="main-heading">Smart Portfolio Allocator</h1>

  <!-- ICON ROW (theme toggle, PDF) - doesn't affect heading centering -->
  <div class="icon-row">
    <button class="theme-toggle" id="themeToggleBtn" onclick="cycleTheme()">‚òÄÔ∏è
      <span class="theme-status" id="themeStatus"></span>
    </button>
    <button class="pdf-toggle" id="pdfToggleBtn" onclick="downloadPDF()">üìÑ</button>
  </div>

  <div class="container">
    <!-- 1) Base Currency + Amount -->
    <div class="flex-row">
      <div class="flex-col">
        <label for="baseCurrency">Base Currency</label>
        <select id="baseCurrency" onchange="showImmediateConversions()">
          <option value="AUD" selected>AUD</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="GBP">GBP</option>
          <option value="CAD">CAD</option>
          <option value="CHF">CHF</option>
          <option value="JPY">JPY</option>
          <option value="CNY">CNY</option>
          <option value="HKD">HKD</option>
          <option value="NZD">NZD</option>
          <option value="SEK">SEK</option>
          <option value="SGD">SGD</option>
          <option value="ZAR">ZAR</option>
          <option value="INR">INR</option>
          <option value="KRW">KRW</option>
          <option value="AED">AED</option>
          <option value="BRL">BRL</option>
          <option value="MXN">MXN</option>
          <option value="RUB">RUB</option>
          <option value="TRY">TRY</option>
        </select>
      </div>
      <div class="flex-col">
        <label for="investmentAmount">Amount to Invest</label>
        <input type="number" id="investmentAmount" step="any" placeholder="Enter amount" value="30000"
               oninput="showImmediateConversions()">
      </div>
    </div>

    <!-- 2) Conversion Currency + Stablecoin + Get Rates -->
    <div class="flex-row">
      <div class="flex-col">
        <label for="conversionCurrency">Conversion Currency</label>
        <select id="conversionCurrency" onchange="showImmediateConversions()">
          <option value="AED" selected>AED</option>
          <option value="AUD">AUD</option>
          <option value="USD">USD</option>
          <option value="EUR">EUR</option>
          <option value="GBP">GBP</option>
          <option value="CAD">CAD</option>
          <option value="CHF">CHF</option>
          <option value="JPY">JPY</option>
          <option value="CNY">CNY</option>
          <option value="HKD">HKD</option>
          <option value="NZD">NZD</option>
          <option value="SEK">SEK</option>
          <option value="SGD">SGD</option>
          <option value="ZAR">ZAR</option>
          <option value="INR">INR</option>
          <option value="KRW">KRW</option>
          <option value="BRL">BRL</option>
          <option value="MXN">MXN</option>
          <option value="RUB">RUB</option>
          <option value="TRY">TRY</option>
        </select>
      </div>
      <div class="flex-col">
        <label for="stablecoin">Stablecoin</label>
        <select id="stablecoin" onchange="showImmediateConversions()">
          <option value="USDT" selected>USDT</option>
          <option value="USDC">USDC</option>
        </select>
      </div>
      <div class="flex-col">
        <label>Live Rates</label>
        <button class="btn-get-rates" onclick="updateExchangeRates()">Get Live Rates</button>
      </div>
    </div>

    <!-- Immediate Conversion -->
    <div id="immediateConversionDisplay" style="margin-bottom:15px;"></div>

    <!-- 3) Category %: Core, Spec, Reserve -->
    <div class="flex-row">
      <div class="flex-col">
        <label for="corePct">Core % of Total</label>
        <select id="corePct">
          <option value="0">0%</option><option value="5">5%</option><option value="10">10%</option>
          <option value="15">15%</option><option value="20">20%</option><option value="25">25%</option>
          <option value="30">30%</option><option value="35">35%</option><option value="40">40%</option>
          <option value="45">45%</option><option value="50" selected>50%</option><option value="55">55%</option>
          <option value="60">60%</option><option value="65">65%</option><option value="70">70%</option>
          <option value="75">75%</option><option value="80">80%</option><option value="85">85%</option>
          <option value="90">90%</option><option value="95">95%</option><option value="100">100%</option>
        </select>
      </div>
      <div class="flex-col">
        <label for="specPct">Spec % of Total</label>
        <select id="specPct">
          <option value="0">0%</option><option value="5">5%</option><option value="10">10%</option>
          <option value="15">15%</option><option value="20">20%</option><option value="25">25%</option>
          <option value="30">30%</option><option value="35">35%</option><option value="40">40%</option>
          <option value="45">45%</option><option value="50">50%</option><option value="55">55%</option>
          <option value="60">60%</option><option value="65">65%</option><option value="70">70%</option>
          <option value="75" selected>75%</option><option value="80">80%</option><option value="85">85%</option>
          <option value="90">90%</option><option value="95">95%</option><option value="100">100%</option>
        </select>
      </div>
      <div class="flex-col">
        <label for="reservePct">Reserve % of Total</label>
        <select id="reservePct">
          <option value="0">0%</option><option value="5">5%</option><option value="10">10%</option>
          <option value="15">15%</option><option value="20">20%</option>
          <option value="25" selected>25%</option><option value="30">30%</option><option value="35">35%</option>
          <option value="40">40%</option><option value="45">45%</option><option value="50">50%</option>
          <option value="55">55%</option><option value="60">60%</option><option value="65">65%</option>
          <option value="70">70%</option><option value="75">75%</option><option value="80">80%</option>
          <option value="85">85%</option><option value="90">90%</option><option value="95">95%</option>
          <option value="100">100%</option>
        </select>
      </div>
    </div>

    <!-- Core Positions Heading with extra Calc button next to it -->
    <div class="positions-container">
      <div class="positions-header-row">
        <h2 style="margin:0;">Core Positions</h2>
        <button class="btn-calculate" onclick="calculateAllocations()">Calculate Allocations</button>
      </div>
      <div id="corePositionsList"></div>
      <button class="btn-add" onclick="addPosition('core')">Add Core Position</button>
    </div>

    <!-- Speculative Positions -->
    <div class="positions-container">
      <h2 style="margin:0;">Speculative Positions</h2>
      <div id="specPositionsList"></div>
      <button class="btn-add" onclick="addPosition('spec')">Add Spec Position</button>
    </div>

    <!-- Reserve Positions -->
    <div class="positions-container">
      <h2 style="margin:0;">Reserve Positions</h2>
      <div id="reservePositionsList"></div>
      <div class="bottom-btn-row">
        <button class="btn-add" onclick="addPosition('reserve')">Add Reserve Position</button>
        <button class="btn-calculate" onclick="calculateAllocations()">Calculate Allocations</button>
      </div>
    </div>

    <!-- Results -->
    <div id="results"></div>
  </div>

  <script>
    /**************************************************
     THEME
    **************************************************/
    let themeModeIndex=0;
    const themeIcons=["‚òÄÔ∏è","üåô","üíª"];
    const themeLabels=["Light","Dark","System"];
    function cycleTheme(){
      themeModeIndex=(themeModeIndex+1)%3;
      applyTheme();
      showThemeStatus(themeLabels[themeModeIndex]);
    }
    function applyTheme(){
      document.body.classList.remove("light-mode","dark-mode","system-mode");
      if(themeModeIndex===0) document.body.classList.add("light-mode");
      else if(themeModeIndex===1) document.body.classList.add("dark-mode");
      else document.body.classList.add("system-mode");
      document.getElementById("themeToggleBtn").textContent=themeIcons[themeModeIndex];
      saveTheme();
    }
    function showThemeStatus(msg){
      const st=document.getElementById("themeStatus");
      st.textContent=msg;
      st.style.opacity="1";
      setTimeout(()=>{st.style.opacity="0";},1500);
    }
    function saveTheme(){
      localStorage.setItem("themeModeIndex",themeModeIndex.toString());
    }
    function loadTheme(){
      const t=localStorage.getItem("themeModeIndex");
      if(t!==null){
        themeModeIndex=parseInt(t,10);
        applyTheme();
      }
    }

    /**************************************************
     PDF DOWNLOAD
    **************************************************/
    function downloadPDF(){
      const resultsEl=document.getElementById("results");
      if(!resultsEl||!resultsEl.textContent.trim()){
        alert("No results to export. Please Calculate Allocations first.");
        return;
      }
      const content=resultsEl.innerText||resultsEl.textContent;
      createPDF(content);
    }

    /**************************************************
     MAIN
    **************************************************/
    let corePositions=[];
    let specPositions=[];
    let reservePositions=[];
    let exchangeData={};

    window.onload=function(){
      loadTheme();
      loadPositions();
      renderAllPositions();
      updateExchangeRates();
    };

    function addPosition(cat){
      const id=cat+"-"+Date.now();
      const newObj={id,ticker:"",percentOfFull:"",baseAlloc:"",stableAlloc:""};
      if(cat==="core") corePositions.push(newObj);
      else if(cat==="spec") specPositions.push(newObj);
      else reservePositions.push(newObj);
      savePositions();
      renderAllPositions();
    }
    function removePosition(cat,id){
      if(cat==="core") corePositions=corePositions.filter(p=>p.id!==id);
      else if(cat==="spec") specPositions=specPositions.filter(p=>p.id!==id);
      else reservePositions=reservePositions.filter(p=>p.id!==id);
      savePositions();
      renderAllPositions();
    }

    function renderAllPositions(){
      const cList=document.getElementById("corePositionsList");
      const sList=document.getElementById("specPositionsList");
      const rList=document.getElementById("reservePositionsList");
      cList.innerHTML="";
      sList.innerHTML="";
      rList.innerHTML="";

      corePositions.forEach(pos=>{ cList.appendChild(createPositionRow(pos,"core")); });
      specPositions.forEach(pos=>{ sList.appendChild(createPositionRow(pos,"spec")); });
      reservePositions.forEach(pos=>{ rList.appendChild(createPositionRow(pos,"reserve")); });
    }

    function createPositionRow(pos,cat){
      const row=document.createElement("div");
      row.className="position-row";

      // Ticker
      const tickerWrap=document.createElement("div");
      tickerWrap.className="position-field";
      const tickerLabel=document.createElement("label");
      tickerLabel.textContent="Ticker";
      const tickerInput=document.createElement("input");
      tickerInput.type="text";
      tickerInput.value=pos.ticker;
      tickerInput.classList.add("ticker-input");
      tickerInput.onchange=()=>updateTicker(cat,pos.id,tickerInput.value);
      tickerWrap.appendChild(tickerLabel);
      tickerWrap.appendChild(tickerInput);

      // % of Full
      const percentWrap=document.createElement("div");
      percentWrap.className="position-field";
      const percentLabel=document.createElement("label");
      percentLabel.textContent="Select %";
      const percentSelect=document.createElement("select");
      percentSelect.innerHTML=`
        <option value="">(Select %)</option>
        <option value="0.25">25%</option>
        <option value="0.5">50%</option>
        <option value="0.75">75%</option>
        <option value="1">100%</option>
        <option value="2">200%</option>
        <option value="3">300%</option>
      `;
      percentSelect.value=pos.percentOfFull;
      percentSelect.classList.add("percent-select");
      percentSelect.onchange=()=>updatePercentOfFull(cat,pos.id,percentSelect.value);
      percentWrap.appendChild(percentLabel);
      percentWrap.appendChild(percentSelect);

      // Base Alloc
      const baseWrap=document.createElement("div");
      baseWrap.className="position-field";
      const baseLabel=document.createElement("label");
      baseLabel.textContent="Base Alloc";
      const baseInput=document.createElement("input");
      baseInput.type="text";
      baseInput.readOnly=true;
      baseInput.classList.add("base-input");
      baseInput.value=pos.baseAlloc||"";
      baseWrap.appendChild(baseLabel);
      baseWrap.appendChild(baseInput);

      // Stable Alloc
      const stableWrap=document.createElement("div");
      stableWrap.className="position-field";
      const stableLabel=document.createElement("label");
      stableLabel.textContent="Stable Alloc";
      const stableInput=document.createElement("input");
      stableInput.type="text";
      stableInput.readOnly=true;
      stableInput.classList.add("stable-input");
      stableInput.value=pos.stableAlloc||"";
      stableWrap.appendChild(stableLabel);
      stableWrap.appendChild(stableInput);

      // Remove
      const rmBtn=document.createElement("button");
      rmBtn.className="btn-remove";
      rmBtn.textContent="Remove";
      rmBtn.onclick=()=>removePosition(cat,pos.id);

      row.appendChild(tickerWrap);
      row.appendChild(percentWrap);
      row.appendChild(baseWrap);
      row.appendChild(stableWrap);
      row.appendChild(rmBtn);

      return row;
    }

    function updateTicker(cat,id,val){
      const arr=getArray(cat);
      const p=arr.find(x=>x.id===id);
      if(p){p.ticker=val;savePositions();}
    }
    function updatePercentOfFull(cat,id,val){
      const arr=getArray(cat);
      const p=arr.find(x=>x.id===id);
      if(p){p.percentOfFull=val;savePositions();}
    }
    function getArray(cat){
      return cat==="core"? corePositions : (cat==="spec"? specPositions : reservePositions);
    }

    function savePositions(){
      localStorage.setItem("corePositions",JSON.stringify(corePositions));
      localStorage.setItem("specPositions",JSON.stringify(specPositions));
      localStorage.setItem("reservePositions",JSON.stringify(reservePositions));
    }
    function loadPositions(){
      const c=localStorage.getItem("corePositions");
      const s=localStorage.getItem("specPositions");
      const r=localStorage.getItem("reservePositions");
      corePositions=c?JSON.parse(c):[];
      specPositions=s?JSON.parse(s):[];
      reservePositions=r?JSON.parse(r):[];

      if(corePositions.length===0){
        corePositions.push({id:"core-"+Date.now(),ticker:"",percentOfFull:"",baseAlloc:"",stableAlloc:""});
      }
      if(specPositions.length===0){
        specPositions.push({id:"spec-"+Date.now(),ticker:"",percentOfFull:"",baseAlloc:"",stableAlloc:""});
      }
      if(reservePositions.length===0){
        reservePositions.push({id:"reserve-"+Date.now(),ticker:"",percentOfFull:"",baseAlloc:"",stableAlloc:""});
      }
    }

    /* EXCHANGE RATES */
    async function updateExchangeRates(){
      const base=document.getElementById("baseCurrency").value;
      try{
        const resp=await fetch(`https://api.exchangerate-api.com/v4/latest/${base}`);
        if(!resp.ok)throw new Error("Bad response");
        const data=await resp.json();
        exchangeData[base]=data;
        alert("Exchange rates updated!");
        showImmediateConversions();
      }catch(err){
        alert("Could not fetch live rates. Using old or no data.");
      }
    }
    function getRate(base,target){
      if(!exchangeData[base]||!exchangeData[base].rates)return null;
      if(base===target)return 1;
      return exchangeData[base].rates[target]||null;
    }

    /* IMMEDIATE CONVERSION */
    function showImmediateConversions(){
      const base=document.getElementById("baseCurrency").value;
      const amount=parseFloat(document.getElementById("investmentAmount").value)||0;
      const conv=document.getElementById("conversionCurrency").value;
      const stable=document.getElementById("stablecoin").value;

      const disp=document.getElementById("immediateConversionDisplay");
      disp.innerHTML="";

      const rateToConv=getRate(base,conv);
      const rateToUSD=getRate(base,"USD");
      if(rateToConv===null||rateToUSD===null){
        disp.innerHTML=`<p style="color:red;">No live exchange rate data. Click "Get Live Rates".</p>`;
        return;
      }

      const convVal=amount*rateToConv;
      const stableVal=amount*rateToUSD;
      disp.innerHTML=`
        <p><strong>Immediate Conversion:</strong><br/>
        ${amount.toLocaleString()} ${base} =
        ${convVal.toLocaleString()} ${conv},
        = ${stableVal.toLocaleString()} ${stable}
        </p>
      `;
    }

    /* CALCULATE ALLOCATIONS */
    function calculateAllocations(){
      const base=document.getElementById("baseCurrency").value;
      const amount=parseFloat(document.getElementById("investmentAmount").value)||0;
      const conv=document.getElementById("conversionCurrency").value;
      const stable=document.getElementById("stablecoin").value;

      const cPct=parseInt(document.getElementById("corePct").value)||0;
      const sPct=parseInt(document.getElementById("specPct").value)||0;
      const rPct=parseInt(document.getElementById("reservePct").value)||0;
      const totalPct=cPct+sPct+rPct;
      if(totalPct!==100){
        const go=confirm(`Warning: categories add up to ${totalPct}%. Continue anyway?`);
        if(!go)return;
      }

      const rounding=parseFloat(prompt("Enter rounding increment (e.g. 500):","500"))||500;
      const rateToConv=getRate(base,conv);
      const rateToUSD=getRate(base,"USD");
      if(rateToConv===null||rateToUSD===null){
        alert("No valid exchange rates. Please Get Live Rates first.");
        return;
      }

      function roundToNearest(val,inc){return Math.round(val/inc)*inc;}

      const coreBudget=(cPct/100)*amount;
      const specBudget=(sPct/100)*amount;
      const reserveBudget=(rPct/100)*amount;

      let allocations=[];
      function allocateCategory(arr,catName,budget){
        let sumFactors=arr.reduce((acc,x)=>acc+parseFloat(x.percentOfFull||0),0);
        if(sumFactors===0) sumFactors=1;
        arr.forEach(p=>{
          const factor=parseFloat(p.percentOfFull||0);
          const rawAlloc=(factor/sumFactors)*budget;
          const allocBase=roundToNearest(rawAlloc,rounding);
          const allocConv=roundToNearest(allocBase*rateToConv,rounding);
          const allocStable=roundToNearest(allocBase*rateToUSD,rounding);

          p.baseAlloc=allocBase.toString();
          p.stableAlloc=allocStable.toString();

          allocations.push({
            category:catName,
            ticker:p.ticker||"(none)",
            baseAlloc:allocBase,
            convAlloc:allocConv,
            stableAlloc:allocStable
          });
        });
      }
      allocateCategory(corePositions,"Core",coreBudget);
      allocateCategory(specPositions,"Speculative",specBudget);
      allocateCategory(reservePositions,"Reserve",reserveBudget);

      savePositions();
      renderAllPositions();

      const sumBase=allocations.reduce((a,b)=>a+b.baseAlloc,0);
      const sumConv=allocations.reduce((a,b)=>a+b.convAlloc,0);
      const sumStable=allocations.reduce((a,b)=>a+b.stableAlloc,0);

      let html=`
        <h2>Results</h2>
        <p><strong>Total ${base} Entered:</strong> ${amount.toLocaleString()} ${base}</p>
        <p>Equivalent in ${conv}: ${(amount*rateToConv).toLocaleString()} ${conv} |
           in ${stable}: ${(amount*rateToUSD).toLocaleString()} ${stable}</p>
        <table>
          <tr>
            <th>Category</th>
            <th>Ticker</th>
            <th>Allocation (${base})</th>
            <th>Allocation (${conv})</th>
            <th>Allocation (${stable})</th>
          </tr>
      `;
      allocations.forEach(a=>{
        html+=`
          <tr>
            <td>${a.category}</td>
            <td>${a.ticker}</td>
            <td>${a.baseAlloc.toLocaleString()}</td>
            <td>${a.convAlloc.toLocaleString()}</td>
            <td>${a.stableAlloc.toLocaleString()}</td>
          </tr>
        `;
      });
      html+=`
          <tr>
            <td colspan="2"><strong>Total</strong></td>
            <td><strong>${sumBase.toLocaleString()} ${base}</strong></td>
            <td><strong>${sumConv.toLocaleString()} ${conv}</strong></td>
            <td><strong>${sumStable.toLocaleString()} ${stable}</strong></td>
          </tr>
        </table>
      `;
      document.getElementById("results").innerHTML=html;
    }
  </script>
</body>
</html>
